<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flashcard Generator</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
  <style>
    .icon-wrapper {
      display: inline-block;
      width: 30px;
      height: 30px;
      cursor: pointer;
      border: 1px solid #000000;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .icon-wrapper:hover {
      background-color: #f0f0f0;
    }

    .selected-icon {
      background-color: yellow; /* color per l'icona selezionata */
      border-radius: 50%;
    }

    .unselected-icon {
      color: #ccc; /* color grigio per l'icona non selezionata */
    }

    .container-radio {
      padding: 2px;
      margin-top: 10px;
    }
  </style>
</head>
<body class="d-flex align-items-center justify-content-center">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js" integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq" crossorigin="anonymous"></script>
  
  <div class="container">
    <!-- Aggiungi una riga per contenere le card e centrarle orizzontalmente -->
    <div id="cards_container" class="row justify-content-center"></div>
    <div class="d-flex justify-content-center mt-3">
      <button type="button" class="btn btn-primary" id="finishTest" onclick="finishTest()">End test</button>
    </div>
    <div id="results">
      <div id="correct_answers"></div>
      <div id="incorrect_answers"></div>
      <div id="elapsed time"></div>
    </div>
  </div>

  <script>
    let group, num;
    
    // Funzione per ottenere i query parameters dalla URL
    function getQueryParams() {
      const urlParams = new URLSearchParams(window.location.search);
      group = urlParams.get('group');  // Ottieni il parametro 'group'
      num = urlParams.get('num');      // Ottieni il parametro 'num'
      console.log(group, num);
    }

    async function createTest() {
      const response = await fetch('/flashcards.json');
      let cards = await response.json();

      if (group != "") {
        console.log("filtering");
        cards = cards.filter((c) => c.group == group);
        console.log(cards.length)
      }
      let numCards = cards.length;
      if (num != "" && num < cards.length) numCards = num;
      
      let cards_container = document.getElementById("cards_container");
      
      if (cards.length == 0) { 
        const htmlstr = `<h2> Error: no card found in the group selected</h2>`;
        cards_container.innerHTML = htmlstr;
        return;
      }

      for (let i = 0; i < numCards; i++) {
        const div = document.createElement('div');
        const htmlstr = `
        <div class="col-12 col-md-6 mb-4"> <!-- Aggiungi col-12 per ogni card che occupa tutta la larghezza della riga su dispositivi piccoli, e col-md-6 per dispositivi medi -->
          <div class="card h-100" style="border: 2px solid ${cards[i].borderColor};">
            <div class="card-body d-flex flex-column" style="padding-top:0px;">
              <div class="colorful-card-title">
                <h5 class="card-title">${cards[i].title}</h5>
              </div>
              <p class="card-text">${cards[i].question}</p>
              <div class="mt-auto">
                <button class="btn btn-primary card-button me-2" onclick="seeAnswer('${cards[i].title}')">Vedi risposta</button>
                <div class="d-flex justify-content-start container-radio">
                  <div class="icon-wrapper me-2" onclick="toggleSelection(${i}, 'correct')">
                    <svg id="correct-icon-${i}" class="unselected-icon" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#EA3323">
                      <path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/>
                    </svg>
                  </div>
                  <div class="icon-wrapper" onclick="toggleSelection(${i}, 'incorrect')">
                    <svg id="incorrect-icon-${i}" class="unselected-icon" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#75FB4C">
                      <path d="M382-240 154-468l57-57 171 171 367-367 57 57-424 424Z"/>
                    </svg>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>`;
        
        div.innerHTML = htmlstr;
        cards_container.appendChild(div);
      }
    }

    function toggleSelection(index, type) {
      const correctIcon = document.getElementById(`correct-icon-${index}`);
      const incorrectIcon = document.getElementById(`incorrect-icon-${index}`);

      if (type === 'correct') {
        correctIcon.classList.remove('unselected-icon');
        correctIcon.classList.add('selected-icon');
        incorrectIcon.classList.remove('selected-icon');
        incorrectIcon.classList.add('unselected-icon');
      } else {
        incorrectIcon.classList.remove('unselected-icon');
        incorrectIcon.classList.add('selected-icon');
        correctIcon.classList.remove('selected-icon');
        correctIcon.classList.add('unselected-icon');
      }
    }

    // Funzione per aggiornare la pagina con i dati dei parametri
    function updatePageContent() {
      getQueryParams();

      createTest();
    }

    function countAnswers() {
      correctAnswers = 0;
      incorrectAnswers = 0;

      // Seleziona tutte le card e conta le risposte
      let cards = document.querySelectorAll('.card');
      cards.forEach((card, index) => {
        const correctIcon = card.querySelector(`#correct-icon-${index}`);
        const incorrectIcon = card.querySelector(`#incorrect-icon-${index}`);
        
        if (correctIcon.classList.contains('selected-icon')) {
          correctAnswers++;
        } else if (incorrectIcon.classList.contains('selected-icon')) {
          incorrectAnswers++;
        }
      });
    }


     // Funzione per finire il test e mostrare i risultati
    function finishTest() {
      countAnswers();

      // Nascondi le card e mostra il risultato
      document.getElementById("cards_container").style.display = "none";
      document.getElementById("finishTest").style.display = "none";
      document.getElementById("results").style.display = "block";
      
      document.getElementById('correct_answers').textContent = `Correct answers: ${correctAnswers}`;
      document.getElementById('incorrect_answers').textContent = `Incorrect answers: ${incorrectAnswers}`;
    }

    // Esegui la funzione quando la pagina Ã¨ completamente caricata
    document.addEventListener("DOMContentLoaded", updatePageContent);
  </script>
</body>
</html>
